; PlatformIO Project Configuration File for ESP_ClapMetronome
;
; Migrated from Arduino IDE (.ino) to PlatformIO
; Supports both ESP8266 and ESP32 platforms
; Phase 05: Test-Driven Development (TDD) - ISO/IEC/IEEE 12207:2017
;
; Build configuration:
;   pio run -e esp32dev        # Build for ESP32
;   pio run -e nodemcuv2       # Build for ESP8266
;   pio run -e esp32dev -t upload   # Upload to ESP32
;
; Testing:
;   pio test -e native         # Run unit tests (desktop)
;   pio test -e esp32dev       # Run tests on ESP32 hardware
;
; Serial monitor:
;   pio device monitor --baud 115200

[platformio]
default_envs = esp32dev
description = Clap-based metronome with automatic tempo detection (TDD Phase 05)

[env]
; Common settings for all environments
; NOTE: framework = arduino is set per-environment (not compatible with native)
monitor_speed = 115200
upload_speed = 921600

; Common library dependencies
lib_deps = 
    adafruit/Adafruit MCP23017 Arduino Library @ ^2.3.2
    adafruit/RTClib @ ^2.1.4
    256dpi/MQTT @ ^2.5.2

; Build flags common to all platforms
build_flags = 
    -D NLCD                    ; Disable LCD display (comment out to enable)
    -Wall                      ; Enable all warnings
    -Wextra                    ; Extra warnings

[env:esp32dev]
; ESP32 Development Board Configuration
platform = espressif32 @ ^6.5.0
framework = arduino
board = esp32dev
board_build.mcu = esp32
board_build.f_cpu = 240000000L
board_build.f_flash = 80000000L
board_build.flash_mode = dio

; ESP32-specific libraries
lib_deps = 
    ${env.lib_deps}

; ESP32-specific build flags
build_flags = 
    ${env.build_flags}
    -D ESP32
    -D ARDUINO_ARCH_ESP32

; Monitor filters
monitor_filters = 
    esp32_exception_decoder
    time

[env:nodemcuv2]
; ESP8266 NodeMCU V2 Configuration
platform = espressif8266 @ ^4.2.1
framework = arduino
board = nodemcuv2
board_build.mcu = esp8266
board_build.f_cpu = 160000000L
board_build.f_flash = 80000000L
board_build.flash_mode = dout
board_build.ldscript = eagle.flash.4m2m.ld

; ESP8266-specific libraries
lib_deps = 
    ${env.lib_deps}

; ESP8266-specific build flags
build_flags = 
    ${env.build_flags}
    -D ESP8266
    -D ARDUINO_ARCH_ESP8266
    -Wl,-Teagle.flash.4m2m.ld

; Monitor filters
monitor_filters = 
    esp8266_exception_decoder
    time

[env:esp32dev-debug]
; ESP32 with debug symbols
extends = env:esp32dev
build_type = debug
build_flags = 
    ${env:esp32dev.build_flags}
    -D DEBUG
    -D CORE_DEBUG_LEVEL=5
    -O0
    -ggdb

[env:nodemcuv2-debug]
; ESP8266 with debug symbols
extends = env:nodemcuv2
build_type = debug
build_flags = 
    ${env:nodemcuv2.build_flags}
    -D DEBUG
    -O0
    -ggdb

[env:native]
; Native (desktop) testing environment for unit tests
; Runs on CI/CD without hardware
platform = native
build_flags = 
    -D UNIT_TEST
    -D NATIVE_BUILD
    -std=gnu++17
    -Wall
    -Wextra
    -Werror
    -O0
    -ggdb
lib_deps = 
    google/googletest @ ^1.14.0
test_framework = googletest
test_build_src = yes
test_filter = test_*
debug_test = test_*
